// RUN: %locic %s --interpret > %t
// RUN: FileCheck < %t %s

// CHECK: getValue for ptr_lval
// CHECK: getPtrLval
// CHECK: getValue for custom lval
// CHECK: getCustomLval

import void printf(const ubyte * str, ...);

lval ptr_lval_t<int> getPtrLval(int* ptr) {
	printf(C"getPtrLval\n");
	return *ptr;
}

int getValue(const ubyte* type) {
	printf(C"getValue for %s\n", type);
	return 42;
}

class CustomLval(int* ptr) {
	static create = default;
	
	void assign(int value) {
		*@ptr = value;
	}
}

lval CustomLval getCustomLval(int* ptr) {
	printf(C"getCustomLval\n");
	return lval(CustomLval(ptr));
}

export int main(unused int argc, unused ubyte ** argv) {
	// Expecting right-to-left evaluation order here.
	
	int value = 0;
	
	{
		// First check that ptr_lval assignments are right-to-left;
		// this is potentially different to custom lvals because
		// ptr_lval is a primitive.
		getPtrLval(&value) = getValue(C"ptr_lval\n");
	}
	
	{
		// Check that user-specified lval assignments are right-to-left.
		getCustomLval(&value) = getValue(C"custom lval\n");
	}
	return 0;
}

