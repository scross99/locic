// RUN: %locic %s --interpret > %t
// RUN: FileCheck < %t %s

// CHECK: custom_lval.Create: Value = 4
// CHECK: custom_lval.dissolve: Value = 4
// CHECK: main: Value = 4
// CHECK: custom_lval.address: Value = 4
// CHECK: addressAssignFunction: Previous value = 4
// CHECK: addressAssignFunction: New value = 10
// CHECK: custom_lval.dissolve: Value = 10
// CHECK: main: Value = 10
// CHECK: custom_lval.dissolve: Value = 10
// CHECK: assignFunction: Previous value = 10
// CHECK: custom_lval.assign: Previous value = 10, New value = 20
// CHECK: custom_lval.dissolve: Value = 20
// CHECK: assignFunction: New value = 20
// CHECK: custom_lval.dissolve: Value = 20
// CHECK: main: Value = 20
// CHECK: custom_lval.dissolve: Value = 20
// CHECK: moveFunction: Previous value = 20
// CHECK: custom_lval.move: Value = 20
// CHECK: moveFunction: Moved value = 20
// CHECK: custom_lval.dissolve: Value = 0
// CHECK: moveFunction: New value = 0
// CHECK: custom_lval.dissolve: Value = 0
// CHECK: main: Value = 0

import void printf(const ubyte * str, ...);

class custom_lval(int value) {
	static Create(int value) {
		printf(C"custom_lval.Create: Value = %d\n", value);
		return @(value);
	}
	
	int* address() {
		printf(C"custom_lval.address: Value = %d\n", @value);
		return &@value;
	}

	void assign(int value) {
		printf(C"custom_lval.assign: Previous value = %d, New value = %d\n", @value, value);
		@value = value;
	}
	
	int& dissolve() {
		printf(C"custom_lval.dissolve: Value = %d\n", @value);
		return @value;
	}
	
	int move() {
		printf(C"custom_lval.move: Value = %d\n", @value);
		int value = @value;
		@value = 0;
		return value;
	}
}

void addressAssignFunction(lval<int> custom_lval& objectLval, int value) {
	int* valuePtr = &objectLval;
	
	printf(C"addressAssignFunction: Previous value = %d\n", *valuePtr);
	
	*valuePtr = value;
	
	printf(C"addressAssignFunction: New value = %d\n", *valuePtr);
}

void assignFunction(lval<int> custom_lval& objectLval, int value) {
	printf(C"assignFunction: Previous value = %d\n", objectLval);
	
	objectLval = value;
	
	printf(C"assignFunction: New value = %d\n", objectLval);
}

void moveFunction(lval<int> custom_lval& objectLval) {
	printf(C"moveFunction: Previous value = %d\n", objectLval);
	
	int value = move objectLval;
	
	printf(C"moveFunction: Moved value = %d\n", value);
	
	printf(C"moveFunction: New value = %d\n", objectLval);
}

export int main(unused int argc, unused ubyte ** argv) {
	lval<int> custom_lval value = lval<int>(custom_lval(4));
	
	printf(C"main: Value = %d\n", value);
	
	addressAssignFunction(value, 10);
	
	printf(C"main: Value = %d\n", value);
	
	assignFunction(value, 20);
	
	printf(C"main: Value = %d\n", value);
	
	moveFunction(value);
	
	printf(C"main: Value = %d\n", value);
	
	return 0;
}

